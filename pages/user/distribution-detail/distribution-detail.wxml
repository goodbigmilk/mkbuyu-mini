<!--pages/user/distribution-detail/distribution-detail.wxml-->
<view class="distribution-detail-page">
  <!-- 加载状态 -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 主要内容 -->
  <view class="main-content" wx:else>
    <!-- 分账概览 -->
    <view class="overview-section">
      <view class="overview-card">
        <view class="order-info">
          <text class="order-label">订单号</text>
          <text class="order-value">{{distributionDetail.order_no}}</text>
        </view>
        <view class="distribution-info">
          <text class="amount-label">分账总额</text>
          <text class="amount-value">¥{{distributionDetail.display_amount}}</text>
        </view>
        <view class="status-info">
          <text class="status-label">分账状态</text>
          <view class="status-badge status-{{distributionDetail.status}}">
            {{distributionDetail.status_text}}
          </view>
        </view>
        <view class="time-info" wx:if="{{distributionDetail.settled_at}}">
          <text class="time-label">结算时间</text>
          <text class="time-value">{{distributionDetail.settled_at}}</text>
        </view>
      </view>
    </view>

    <!-- 商品分账明细 -->
    <view class="detail-section">
      <view class="section-header">
        <text class="section-title">商品分账明细</text>
        <text class="section-count">共{{productDetails.length}}件商品</text>
      </view>
      
      <view class="product-list">
        <view class="product-item" wx:for="{{productDetails}}" wx:key="id">
          <view class="product-image-container">
            <image 
              class="product-image" 
              src="{{item.product_image || '/images/placeholder.png'}}" 
              mode="aspectFill"
              lazy-load="true"
            />
          </view>
          
          <view class="product-info">
            <view class="product-name">{{item.product_name}}</view>
            
            <view class="price-info">
              <view class="price-row">
                <text class="price-label">原价：</text>
                <text class="original-price">¥{{item.display_original_price}}</text>
              </view>
              <view class="price-row">
                <text class="price-label">特权价：</text>
                <text class="privilege-price">¥{{item.display_privilege_price}}</text>
              </view>
              <view class="price-row">
                <text class="price-label">单品分账：</text>
                <text class="unit-distribution">¥{{item.display_unit_distribution}}</text>
              </view>
            </view>
            
            <view class="quantity-info">
              <text class="quantity-text">数量：{{item.quantity}}</text>
            </view>
          </view>
          
          <view class="distribution-amount">
            <text class="distribution-label">分账金额</text>
            <text class="distribution-value">¥{{item.display_total_distribution}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 分账汇总 -->
    <view class="summary-section">
      <view class="summary-card">
        <view class="summary-header">
          <text class="summary-title">分账汇总</text>
        </view>
        <view class="summary-content">
          <view class="summary-row">
            <text class="summary-label">商品总数</text>
            <text class="summary-value">{{totalQuantity}}件</text>
          </view>
          <view class="summary-row">
            <text class="summary-label">原价总计</text>
            <text class="summary-value">¥{{totalOriginalPrice}}</text>
          </view>
          <view class="summary-row">
            <text class="summary-label">特权价总计</text>
            <text class="summary-value">¥{{totalPrivilegePrice}}</text>
          </view>
          <view class="summary-row total-row">
            <text class="summary-label">分账总额</text>
            <text class="summary-value highlight">¥{{distributionDetail.display_amount}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{!loading && productDetails.length === 0}}">
      <text class="empty-text">暂无分账明细</text>
      <text class="empty-desc">该订单暂时没有分账记录</text>
    </view>
  </view>
</view>
