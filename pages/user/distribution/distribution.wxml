<view class="distribution-page">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-value">{{stats.total_amount || 0}}</text>
        <text class="stats-label">æ€»é‡‘é¢</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.pending_amount || 0}}</text>
        <text class="stats-label">å¾…åˆ†è´¦</text>
      </view>
      <view class="stats-item">
        <text class="stats-value">{{stats.settled_amount || 0}}</text>
        <text class="stats-label">å·²ç»“ç®—</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½å¯¼èˆª -->
  <view class="nav-section">
    <view class="nav-item" bindtap="goToCustomers">
      <view class="nav-content">
        <text class="nav-icon">ğŸ‘¥</text>
        <view class="nav-text">
          <text class="nav-title">æ¨èç”¨æˆ·</text>
          <text class="nav-desc">æŸ¥çœ‹æˆ‘çš„æ¨èå®¢æˆ·</text>
        </view>
      </view>
      <text class="nav-arrow">></text>
    </view>
  </view>

  <!-- åˆ†è´¦è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <view class="list-header">
      <text class="list-title">åˆ†è´¦è®¢å•åˆ—è¡¨</text>
    </view>

    <view class="order-item" wx:for="{{distributionList}}" wx:key="id" data-status="{{item.order.status}}">
      <!-- è®¢å•çŠ¶æ€è§’æ ‡ -->
      <view class="order-status-corner status-{{item.order.status}}">
        {{item.order.status_text}}
      </view>
      
      <!-- å®¢æˆ·ä¿¡æ¯ï¼ˆä¸æ˜¾ç¤ºæ‰‹æœºå·ï¼‰ -->
      <view class="order-header">
        <view class="customer-info">
          <image 
            class="customer-avatar" 
            src="{{item.customer.avatar || '/images/default-avatar.png'}}" 
            mode="aspectFill"
          />
          <view class="customer-details">
            <text class="customer-name">{{item.customer.nickname || 'ç”¨æˆ·' + item.customer.id}}</text>
          </view>
        </view>
      </view>

      <!-- å•†å“åˆ—è¡¨ -->
      <view class="product-container">
        <scroll-view class="product-scroll" scroll-x="true" show-scrollbar="false">
          <view class="product-list">
            <view class="product-item" wx:for="{{item.order.items}}" wx:for-item="product" wx:key="id">
              <image 
                wx:if="{{product.product && product.product.image}}" 
                class="product-image" 
                src="{{product.product.image}}" 
                mode="aspectFill" 
              />
              <view class="product-quantity">x{{product.quantity}}</view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="order-info-section">
        <view class="order-meta">
          <text class="order-no">è®¢å•å·ï¼š{{item.order_no}}</text>
          <view class="order-time">{{item.created_at}}</view>
        </view>
        <view class="order-amount">
          <text>å…±{{item.order.items.length}}ä»¶å•†å“ åˆ†è´¦ <text class="amount-value">Â¥{{item.display_amount}}</text></text>
        </view>
      </view>

      <!-- åˆ†è´¦çŠ¶æ€ -->
      <view class="distribution-status">
        <view class="status-badge status-{{item.status}}">
          {{item.status_text}}
        </view>
        <button 
          class="detail-btn" 
          size="mini"
          data-distribution-id="{{item.id}}"
          bindtap="viewDistributionDetail"
        >æŸ¥çœ‹æ˜ç»†</button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view class="loading-more" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view class="no-more" wx:if="{{!hasMore && distributionList.length > 0}}">
      <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && distributionList.length === 0}}">
      <text class="empty-text">æš‚æ— åˆ†è´¦è®¢å•</text>
      <text class="empty-desc">å½“æ¨èçš„å®¢æˆ·è´­ä¹°ç‰¹æƒå•†å“æ—¶ï¼Œæ‚¨å°†è·å¾—åˆ†è´¦æ”¶ç›Š</text>
    </view>
  </view>
  
  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-space"></view>
</view>

<!-- ç”¨æˆ·åº•éƒ¨å¯¼èˆªæ  -->
<custom-tabbar />
