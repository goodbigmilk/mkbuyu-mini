<view class="register-page">
  <!-- 顶部背景 -->
  <view class="top-bg">
    <view class="bg-gradient"></view>
    <view class="bg-overlay"></view>
  </view>

  <!-- 注册容器 -->
  <view class="register-container">
    <!-- 头部 -->
    <view class="header">
      <image class="logo" src="/assets/images/logo.jpg" mode="aspectFit" />
      <text class="title">创建新账号</text>
      <text class="subtitle">加入买不语，开启购物之旅</text>
    </view>

    <!-- 注册表单 -->
    <view class="register-form">
      <!-- 用户名 -->
      <van-field
        value="{{formData.username}}"
        placeholder="请输入用户名"
        bind:input="onUsernameInput"
        clearable
        left-icon="user-o"
        custom-class="register-field"
        input-class="field-input"
        error-message="{{usernameError}}"
        error="{{!!usernameError}}"
      />
      
      <!-- 显示名称 -->
      <van-field
        value="{{formData.displayName}}"
        placeholder="请输入显示名称（可选）"
        bind:input="onDisplayNameInput"
        clearable
        left-icon="friends-o"
        custom-class="register-field"
        input-class="field-input"
      />

      <!-- 手机号 -->
      <van-field
        value="{{formData.phone}}"
        placeholder="请输入手机号（可选）"
        bind:input="onPhoneInput"
        clearable
        left-icon="phone-o"
        type="number"
        maxlength="11"
        custom-class="register-field"
        input-class="field-input"
        error-message="{{phoneError}}"
        error="{{!!phoneError}}"
      />

      <!-- 邮箱 -->
      <van-field
        value="{{formData.email}}"
        placeholder="请输入邮箱（可选）"
        bind:input="onEmailInput"
        clearable
        left-icon="envelop-o"
        type="email"
        custom-class="register-field"
        input-class="field-input"
        error-message="{{emailError}}"
        error="{{!!emailError}}"
      />

      <!-- 密码 -->
      <van-field
        value="{{formData.password}}"
        type="password"
        placeholder="请输入密码"
        bind:input="onPasswordInput"
        clearable
        left-icon="lock"
        custom-class="register-field"
        input-class="field-input"
        error-message="{{passwordError}}"
        error="{{!!passwordError}}"
      />

      <!-- 确认密码 -->
      <van-field
        value="{{formData.confirmPassword}}"
        type="password"
        placeholder="请确认密码"
        bind:input="onConfirmPasswordInput"
        clearable
        left-icon="lock"
        custom-class="register-field"
        input-class="field-input"
        error-message="{{confirmPasswordError}}"
        error="{{!!confirmPasswordError}}"
      />
    </view>

    <!-- 注册按钮 -->
    <van-button 
      type="primary" 
      size="large"
      loading="{{registering}}"
      bindtap="onRegister"
      custom-class="register-btn"
      icon="add-o"
      disabled="{{!isFormValid}}"
    >
      {{registering ? '注册中...' : '注册账号'}}
    </van-button>

    <!-- Casdoor 注册按钮 -->
    <van-button 
      type="primary" 
      size="large"
      bindtap="onOpenCasdoorSignup"
      custom-class="casdoor-signup-btn"
      plain
    >
      使用 Casdoor 注册
    </van-button>

    <!-- 登录链接 -->
    <view class="login-link">
      <text class="login-text">已有账号？</text>
      <text class="login-btn" bindtap="onGoToLogin">立即登录</text>
    </view>

    <!-- Casdoor 注册 web-view -->
    <view class="casdoor-webview-container" wx:if="{{showCasdoorSignup}}">
      <view class="casdoor-header">
        <text class="casdoor-title">Casdoor 注册</text>
        <view class="casdoor-close" bindtap="onCloseCasdoorSignup">
          <van-icon name="cross" size="20px" />
        </view>
      </view>
      <web-view 
        src="{{casdoorSignupUrl}}" 
        bindmessage="onCasdoorMessage"
        binderror="onCasdoorError"
        bindload="onCasdoorLoad"
      ></web-view>
    </view>

    <!-- 注册说明 -->
    <view class="register-tips">
      <text class="tip-text">• 用户名长度为3-20个字符</text>
      <text class="tip-text">• 密码长度至少6个字符</text>
      <text class="tip-text">• 手机号和邮箱可选填，用于找回密码</text>
    </view>
  </view>

  <!-- 协议同意区域 -->
  <view class="agreement-section">
    <text class="agreement-text">
      注册即表示同意
      <text class="policy-link" bindtap="onViewUserAgreement">《用户协议》</text>
      和
      <text class="policy-link" bindtap="onViewPrivacyPolicy">《隐私政策》</text>
    </text>
  </view>

  <!-- 客服按钮 -->
  <view class="customer-service" bindtap="onContactService">
    <van-icon name="service-o" size="20px" />
    <text>客服</text>
  </view>
</view>