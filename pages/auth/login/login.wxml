<view class="login-page">
  <!-- 顶部背景 -->
  <view class="top-bg">
    <view class="bg-gradient"></view>
    <view class="bg-overlay"></view>
  </view>

  <!-- 登录容器 -->
  <view class="login-container">
    <!-- Logo和标题 -->
    <view class="header">
      <image class="logo" src="/assets/images/logo.jpg" mode="aspectFit" />
      <text class="title">欢迎来到买不语</text>
      <text class="subtitle">您的专属购物平台</text>
    </view>

    <!-- 检查登录状态 -->
    <view class="checking-section" wx:if="{{checking}}">
      <van-loading size="24px" />
      <text class="checking-text">检查登录状态...</text>
    </view>

    <!-- 登录选项 -->
    <view class="login-options" wx:if="{{!checking}}">

      <!-- 账号密码登录表单 -->
      <view class="password-login-form">
        <van-field
          value="{{username}}"
          placeholder="请输入手机号/邮箱/用户名"
          bind:input="onUsernameInput"
          clearable
          left-icon="contact"
          custom-class="login-field"
          input-class="field-input"
        />
        
        <van-field
          value="{{password}}"
          type="password"
          placeholder="请输入密码"
          bind:input="onPasswordInput"
          clearable
          left-icon="lock"
          custom-class="login-field"
          input-class="field-input"
        />
      </view>

      <!-- 密码登录按钮 -->
      <van-button 
        type="primary" 
        size="large"
        loading="{{passwordLoading}}"
        bindtap="onPasswordLogin"
        custom-class="password-login-btn"
        icon="user-o"
        disabled="{{!username || !password}}"
      >
        {{passwordLoading ? '登录中...' : '账号密码登录'}}
      </van-button>

      <!-- 微信一键登录按钮 -->
      <van-button 
        type="info" 
        size="large"
        loading="{{wechatLoading}}"
        bindtap="onStartLogin"
        custom-class="wechat-login-btn"
        icon="wechat"
        plain
      >
        {{wechatLoading ? '跳转中...' : '微信一键登录'}}
      </van-button>

      <!-- Casdoor 登录按钮 -->
      <van-button 
        type="primary" 
        size="large"
        bindtap="onOpenCasdoorLogin"
        custom-class="casdoor-login-btn"
        plain
      >
        使用 Casdoor 登录
      </van-button>

      <!-- 注册链接 -->
      <view class="register-link">
        <text class="register-text">还没有账号？</text>
        <text class="register-btn" bindtap="onGoToRegister">立即注册</text>
      </view>
    </view>

    <!-- Casdoor 登录 web-view -->
    <view class="casdoor-webview-container" wx:if="{{showCasdoorLogin}}">
      <view class="casdoor-header">
        <text class="casdoor-title">Casdoor 登录</text>
        <view class="casdoor-close" bindtap="onCloseCasdoorLogin">
          <van-icon name="cross" size="20px" />
        </view>
      </view>
      <web-view 
        src="{{casdoorLoginUrl}}" 
        bindmessage="onCasdoorMessage"
        binderror="onCasdoorError"
        bindload="onCasdoorLoad"
      ></web-view>
    </view>

    <!-- 协议同意 -->
    <view class="agreement-section" wx:if="{{!checking}}">
      <text class="agreement-text">
        登录即表示同意
        <text class="policy-link" bindtap="onViewUserAgreement">《用户协议》</text>
        和
        <text class="policy-link" bindtap="onViewPrivacyPolicy">《隐私政策》</text>
      </text>
    </view>

  </view>

  <!-- 客服按钮 -->
  <view class="customer-service" bindtap="onContactService">
    <van-icon name="service-o" size="20px" />
    <text>客服</text>
  </view>
</view>